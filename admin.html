<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ú–∏—Å—Å–∏—è–º–∏ | CYBER STRIKE</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Space Grotesk', sans-serif; background:#030712; color:#f8fafc; }
    .glass { background: rgba(255,255,255,0.04); border:1px solid rgba(255,255,255,0.08); border-radius:14px; }
    .gradient { background: linear-gradient(90deg, #00f2ff, #7c3aed); }
  </style>
</head>
<body class="min-h-screen py-12">
  <!-- Security Overlay -->
  <div id="security-overlay" class="fixed inset-0 z-50 bg-[#030712] flex items-center justify-center transition-opacity duration-500">
    <div class="glass p-8 max-w-md w-full space-y-6 text-center shadow-2xl border border-cyan-500/20">
        <div class="text-cyan-400 text-6xl mb-4 animate-pulse">üîí</div>
        <h2 class="text-2xl font-bold uppercase tracking-widest text-cyan-400">–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω</h2>
        <p class="text-slate-400 text-sm">–í —Å–∏—Å—Ç–µ–º–µ –∞–∫—Ç–∏–≤–µ–Ω –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∑–∞—â–∏—Ç—ã. –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ (F12).</p>
        <form id="security-form" class="space-y-4">
            <input type="text" id="security-code" class="w-full bg-black/50 border border-cyan-500/30 rounded-md px-4 py-3 text-center text-xl tracking-[0.5em] text-cyan-400 focus:outline-none focus:border-cyan-400 transition placeholder:tracking-normal" placeholder="PASSWORD" autocomplete="off">
            <button type="submit" class="w-full bg-cyan-500/10 border border-cyan-500/50 hover:bg-cyan-500 hover:text-black text-cyan-400 font-bold py-3 rounded-md transition uppercase tracking-wider">–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å</button>
        </form>
    </div>
  </div>

  <main class="max-w-6xl mx-auto px-6 space-y-10">
    <header class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div>
        <p class="text-cyan-400 text-xs uppercase tracking-[0.35em]">–ü–∞–Ω–µ–ª—å –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
        <h1 class="text-3xl md:text-4xl font-bold">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ú–∏—Å—Å–∏–π</h1>
        <p class="text-slate-400 text-sm mt-2">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∏–ª–∏ —É–¥–∞–ª—è–π—Ç–µ –º–∏—Å—Å–∏–∏. –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.</p>
      </div>
      <div class="flex gap-3">
        <button id="reset-missions" class="px-4 py-2 text-sm font-semibold text-black gradient rounded-md shadow-lg">–°–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫</button>
        <a href="sector1.html" class="px-4 py-2 text-sm font-semibold border border-white/20 rounded-md hover:border-cyan-400 transition">–ù–∞–∑–∞–¥ –Ω–∞ —Å–∞–π—Ç</a>
      </div>
    </header>

    <section class="glass p-6 shadow-xl">
      <form id="mission-form" class="space-y-4">
        <div class="grid md:grid-cols-2 gap-4">
          <label class="block text-sm">–ù–∞–∑–≤–∞–Ω–∏–µ –ú–∏—Å—Å–∏–∏
            <input id="title" name="title" type="text" class="mt-1 w-full bg-black/40 border border-white/10 rounded-md px-3 py-2" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ó–∞—Ö–≤–∞—Ç —Ñ–ª–∞–≥–∞" required>
          </label>
          <label class="block text-sm">–°–ª–æ–∂–Ω–æ—Å—Ç—å / –†–æ–ª—å
            <input id="difficulty" name="difficulty" type="text" class="mt-1 w-full bg-black/40 border border-white/10 rounded-md px-3 py-2" placeholder="–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫" required>
          </label>
        </div>
        <label class="block text-sm">–û–ø–∏—Å–∞–Ω–∏–µ
          <textarea id="summary" name="summary" rows="3" class="mt-1 w-full bg-black/40 border border-white/10 rounded-md px-3 py-2" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏..." required></textarea>
        </label>
        <label class="block text-sm">–ù–∞–≥—Ä–∞–¥–∞
          <input id="reward" name="reward" type="text" class="mt-1 w-full bg-black/40 border border-white/10 rounded-md px-3 py-2" placeholder="XP + –õ—É—Ç" required>
        </label>
        <div class="flex gap-3">
          <button type="submit" class="px-4 py-2 bg-cyan-400 text-black font-semibold rounded-md">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ú–∏—Å—Å–∏—é</button>
          <button type="button" id="cancel-edit" class="px-4 py-2 border border-white/20 rounded-md hidden">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </form>
    </section>

    <section class="glass p-6 shadow-xl">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold">–°–ø–∏—Å–æ–∫ –ú–∏—Å—Å–∏–π</h2>
        <p class="text-xs text-slate-400">–°—Ç–∞—Ç—É—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∏–≥—Ä–æ–∫–∞–º–∏.</p>
      </div>
      <div id="mission-list" class="space-y-3"></div>
    </section>

    <!-- System Logs Section -->
    <section class="glass p-6 shadow-xl border-t-4 border-cyan-500/20">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold flex items-center gap-2">
           <span class="text-cyan-400">üìú</span> –°–∏—Å—Ç–µ–º–Ω—ã–µ –õ–æ–≥–∏
        </h2>
        <button id="clear-logs" class="text-xs text-red-400 hover:text-red-300 transition uppercase tracking-wider">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
      </div>
      <div id="system-logs" class="space-y-2 max-h-60 overflow-y-auto pr-2 font-mono text-xs">
          <!-- Logs will be injected here -->
      </div>
    </section>
  </main>

  <script src="mission.js"></script>
  <script>
    // Security System Logic
    (function() {
        const overlay = document.getElementById('security-overlay');
        const form = document.getElementById('security-form');
        const input = document.getElementById('security-code');
        
        // Pool of 12 cryptic passwords
        const passPool = [
            '#AX-99', '@ZY-21', '!KL-77', '$WQ-34', 
            '%MN-55', '^OP-12', '&GH-88', '*EF-43', 
            '(IJ-66', ')UV-09', '{CD-22}', '}ST-11'
        ];
        
        // Select random password
        const code = passPool[Math.floor(Math.random() * passPool.length)];
        
        console.clear();
        console.log('%c üõ°Ô∏è SYSTEM SECURITY PROTOCOL üõ°Ô∏è ', 'background: #00f2ff; color: #000; font-size: 20px; padding: 10px; border-radius: 4px; font-weight: bold;');
        console.log(`%c ACCESS PASSWORD: ${code}`, 'color: #00f2ff; font-size: 24px; font-weight: bold; margin-top: 10px; border: 2px dashed #00f2ff; padding: 5px 15px;');
        console.log('%c –í–≤–µ–¥–∏—Ç–µ —ç—Ç–æ—Ç –ø–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.', 'color: #94a3b8; margin-top: 5px; font-style: italic;');

        form.addEventListener('submit', (e) => {
            e.preventDefault();
            if (input.value === code) {
                overlay.style.opacity = '0';
                setTimeout(() => overlay.remove(), 500);
                if (window.MissionService && window.MissionService.logAction) {
                    window.MissionService.logAction('SYSTEM_ACCESS', '–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –≤ –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞');
                    // Force re-render to show new log
                    const logsEl = document.getElementById('system-logs');
                    if (logsEl) {
                        // We need to access renderLogs from here, but it's inside the other IIFE
                        // Better to trigger a custom event or just let the user see it on next action/refresh
                        // Or we can move renderLogs to global scope, but let's keep it simple.
                        // Ideally we'd dispatch an event.
                        window.dispatchEvent(new CustomEvent('admin:logged-in'));
                    }
                }
            } else {
                input.value = '';
                input.placeholder = 'ERROR';
                input.classList.add('border-red-500', 'text-red-500');
                if (window.MissionService && window.MissionService.logAction) {
                     window.MissionService.logAction('ACCESS_DENIED', '–ù–µ—É–¥–∞—á–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É');
                }
                setTimeout(() => {
                    input.classList.remove('border-red-500', 'text-red-500');
                    input.placeholder = 'CODE';
                }, 1000);
            }
        });
    })();


    (function () {
      if (!window.MissionService) return;
      const form = document.getElementById('mission-form');
      const resetBtn = document.getElementById('reset-missions');
      const cancelBtn = document.getElementById('cancel-edit');
      const listEl = document.getElementById('mission-list');
      const logsEl = document.getElementById('system-logs');
      const clearLogsBtn = document.getElementById('clear-logs');

      let editingId = null;

      const formFields = {
        title: document.getElementById('title'),
        summary: document.getElementById('summary'),
        difficulty: document.getElementById('difficulty'),
        reward: document.getElementById('reward')
      };

      const renderLogs = () => {
          if (!MissionService.getLogs) return;
          const logs = MissionService.getLogs();
          if (logs.length === 0) {
              logsEl.innerHTML = '<p class="text-slate-600 italic text-center py-4">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –≤ –∂—É—Ä–Ω–∞–ª–µ</p>';
              return;
          }
          logsEl.innerHTML = logs.map(log => {
              const date = new Date(log.timestamp).toLocaleString('ru-RU');
              const colorClass = log.action.includes('DELETE') ? 'text-red-400' : 
                               (log.action.includes('CREATE') ? 'text-green-400' : 
                               (log.action.includes('LOCK') ? 'text-amber-400' : 'text-cyan-400'));
              return `
                <div class="flex gap-3 border-b border-white/5 pb-2 last:border-0 hover:bg-white/5 p-2 rounded transition">
                    <span class="text-slate-500 min-w-[140px]">${date}</span>
                    <span class="${colorClass} font-bold min-w-[120px]">[${log.action}]</span>
                    <span class="text-slate-300">${log.details}</span>
                </div>
              `;
          }).join('');
      };

      const render = () => {
        const missions = MissionService.getAll();
        listEl.innerHTML = '';
        missions.forEach((mission) => {
          const statusText = mission.status === 'locked' ? '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ' : (mission.status === 'available' ? '–î–æ—Å—Ç—É–ø–Ω–æ' : mission.status);
          const card = document.createElement('div');
          card.className = 'flex flex-col md:flex-row md:items-center justify-between gap-3 px-4 py-3 bg-black/30 border border-white/10 rounded-md';
          card.innerHTML = `
            <div>
              <p class="text-xs uppercase tracking-[0.25em] text-cyan-400">${mission.difficulty}</p>
              <h3 class="text-lg font-semibold">${mission.title}</h3>
              <p class="text-sm text-slate-400">${mission.summary}</p>
              <p class="text-xs text-slate-500 mt-1">–ù–∞–≥—Ä–∞–¥–∞: ${mission.reward}</p>
              <p class="text-xs mt-1 ${mission.status === 'locked' ? 'text-amber-400' : 'text-emerald-400'}">–°—Ç–∞—Ç—É—Å: ${statusText}${mission.lockedBy ? ` (–∫–µ–º: ${mission.lockedBy})` : ''}</p>
            </div>
            <div class="flex gap-2">
              <button data-edit="${mission.id}" class="px-3 py-2 text-sm border border-white/20 rounded-md hover:border-cyan-400">–ò–∑–º–µ–Ω–∏—Ç—å</button>
              <button data-delete="${mission.id}" class="px-3 py-2 text-sm border border-red-500/50 text-red-300 rounded-md hover:bg-red-500/10">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
          `;
          listEl.appendChild(card);
        });
        renderLogs();
      };


      const clearForm = () => {
        editingId = null;
        form.reset();
        cancelBtn.classList.add('hidden');
      };

      form.addEventListener('submit', (event) => {
        event.preventDefault();
        const payload = {
          title: formFields.title.value,
          summary: formFields.summary.value,
          difficulty: formFields.difficulty.value,
          reward: formFields.reward.value
        };
        if (editingId) {
          MissionService.updateMission(editingId, payload);
        } else {
          MissionService.addMission(payload);
        }
        clearForm();
        render();
      });

      cancelBtn.addEventListener('click', clearForm);

      listEl.addEventListener('click', (event) => {
        const editId = event.target.getAttribute('data-edit');
        const deleteId = event.target.getAttribute('data-delete');
        if (editId) {
          const mission = MissionService.getAll().find((m) => m.id === editId);
          if (!mission) return;
          editingId = editId;
          formFields.title.value = mission.title;
          formFields.summary.value = mission.summary;
          formFields.difficulty.value = mission.difficulty;
          formFields.reward.value = mission.reward;
          cancelBtn.classList.remove('hidden');
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        if (deleteId) {
          if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –º–∏—Å—Å–∏—é?')) {
            MissionService.removeMission(deleteId);
            if (editingId === deleteId) clearForm();
            render();
          }
        }
      });

      resetBtn.addEventListener('click', () => {
        if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –º–∏—Å—Å–∏–∏ –∫ –Ω–∞—á–∞–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º?')) {
          MissionService.reset();
          clearForm();
          render();
        }
      });
      
      clearLogsBtn.addEventListener('click', () => {
          if(confirm('–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —Å–æ–±—ã—Ç–∏–π?')) {
              MissionService.clearLogs();
              render();
          }
      });
      
      window.addEventListener('admin:logged-in', render);

      render();
    })();
  </script>
</body>
</html>
